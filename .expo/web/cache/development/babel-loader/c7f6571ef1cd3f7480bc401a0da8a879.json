{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\zmais\\\\OneDrive\\\\Desktop\\\\react-apps\\\\signal-chat\\\\screens\\\\Video\\\\RecVideo.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useRef, useEffect } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport { Camera } from \"expo-camera\";\nimport { Video } from \"expo-av\";\nimport { Audio } from \"expo-av\";\nimport Button from \"react-native-web/dist/exports/Button\";\nvar WINDOW_HEIGHT = Dimensions.get(\"window\").height;\nvar closeButtonSize = Math.floor(WINDOW_HEIGHT * 0.032);\nvar captureSize = Math.floor(WINDOW_HEIGHT * 0.09);\nexport default function RecVideo(_ref) {\n  var _this = this;\n\n  var navigation = _ref.navigation;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      hasPermission = _useState2[0],\n      setHasPermission = _useState2[1];\n\n  var _useState3 = useState(Camera.Constants.Type.back),\n      _useState4 = _slicedToArray(_useState3, 2),\n      cameraType = _useState4[0],\n      setCameraType = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isPreview = _useState6[0],\n      setIsPreview = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isCameraReady = _useState8[0],\n      setIsCameraReady = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      isVideoRecording = _useState10[0],\n      setIsVideoRecording = _useState10[1];\n\n  var _useState11 = useState(null),\n      _useState12 = _slicedToArray(_useState11, 2),\n      videoSource = _useState12[0],\n      setVideoSource = _useState12[1];\n\n  var cameraRef = useRef();\n  useEffect(function () {\n    (function _callee() {\n      var _await$Camera$request, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context.sent;\n              status = _await$Camera$request.status;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(Audio.requestPermissionsAsync());\n\n            case 6:\n              setHasPermission(status === \"granted\");\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n\n  var onCameraReady = function onCameraReady() {\n    setIsCameraReady(true);\n  };\n\n  var takePicture = function takePicture() {\n    var options, data, source;\n    return _regeneratorRuntime.async(function takePicture$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!cameraRef.current) {\n              _context2.next = 11;\n              break;\n            }\n\n            options = {\n              quality: 1,\n              base64: true,\n              skipProcessing: true\n            };\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(cameraRef.current.takePictureAsync(options));\n\n          case 4:\n            data = _context2.sent;\n            source = data.uri;\n\n            if (!source) {\n              _context2.next = 11;\n              break;\n            }\n\n            _context2.next = 9;\n            return _regeneratorRuntime.awrap(cameraRef.current.pausePreview());\n\n          case 9:\n            setIsPreview(true);\n            console.log(\"picture source\", source);\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var recordVideo = function recordVideo() {\n    var videoRecordPromise, data, source;\n    return _regeneratorRuntime.async(function recordVideo$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (!cameraRef.current) {\n              _context3.next = 15;\n              break;\n            }\n\n            _context3.prev = 1;\n            videoRecordPromise = cameraRef.current.recordAsync();\n\n            if (!videoRecordPromise) {\n              _context3.next = 10;\n              break;\n            }\n\n            setIsVideoRecording(true);\n            _context3.next = 7;\n            return _regeneratorRuntime.awrap(videoRecordPromise);\n\n          case 7:\n            data = _context3.sent;\n            source = data.uri;\n\n            if (source) {\n              setIsPreview(true);\n              console.log(\"video source\", source);\n              setVideoSource(source);\n            }\n\n          case 10:\n            _context3.next = 15;\n            break;\n\n          case 12:\n            _context3.prev = 12;\n            _context3.t0 = _context3[\"catch\"](1);\n            console.warn(_context3.t0);\n\n          case 15:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 12]], Promise);\n  };\n\n  var stopVideoRecording = function stopVideoRecording() {\n    if (cameraRef.current) {\n      setIsPreview(false);\n      setIsVideoRecording(false);\n      cameraRef.current.stopRecording();\n    }\n  };\n\n  var switchCamera = function switchCamera() {\n    if (isPreview) {\n      return;\n    }\n\n    setCameraType(function (prevCameraType) {\n      return prevCameraType === Camera.Constants.Type.back ? Camera.Constants.Type.front : Camera.Constants.Type.back;\n    });\n  };\n\n  var cancelPreview = function cancelPreview() {\n    return _regeneratorRuntime.async(function cancelPreview$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(cameraRef.current.resumePreview());\n\n          case 2:\n            setIsPreview(false);\n            setVideoSource(null);\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var goBackToOrig = function goBackToOrig() {\n    return _regeneratorRuntime.async(function goBackToOrig$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return _regeneratorRuntime.awrap(navigation.navigate(\"Save-Video\", {\n              video: videoSource\n            }));\n\n          case 2:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var renderCancelPreviewButton = function renderCancelPreviewButton() {\n    return React.createElement(React.Fragment, null, React.createElement(TouchableOpacity, {\n      onPress: cancelPreview,\n      style: styles.closeButton,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 5\n      }\n    }, React.createElement(View, {\n      style: [styles.closeCross, {\n        transform: [{\n          rotate: \"45deg\"\n        }]\n      }],\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }), React.createElement(View, {\n      style: [styles.closeCross, {\n        transform: [{\n          rotate: \"-45deg\"\n        }]\n      }],\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 7\n      }\n    })), renderCancelDoneButton());\n  };\n\n  var renderCancelDoneButton = function renderCancelDoneButton() {\n    return React.createElement(Button, {\n      title: \"Done\",\n      onPress: goBackToOrig,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 5\n      }\n    });\n  };\n\n  var renderVideoPlayer = function renderVideoPlayer() {\n    return React.createElement(Video, {\n      source: {\n        uri: videoSource\n      },\n      shouldPlay: true,\n      style: styles.media,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 5\n      }\n    });\n  };\n\n  var renderVideoRecordIndicator = function renderVideoRecordIndicator() {\n    return React.createElement(View, {\n      style: styles.recordIndicatorContainer,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 5\n      }\n    }, React.createElement(View, {\n      style: styles.recordDot,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 7\n      }\n    }), React.createElement(Text, {\n      style: styles.recordTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 7\n      }\n    }, \"Recording...\"));\n  };\n\n  var renderCaptureControl = function renderCaptureControl() {\n    return React.createElement(View, {\n      style: styles.control,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 5\n      }\n    }, React.createElement(TouchableOpacity, {\n      disabled: !isCameraReady,\n      onPress: switchCamera,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 7\n      }\n    }, React.createElement(Text, {\n      style: styles.text,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }\n    }, \"Flip\")), React.createElement(TouchableOpacity, {\n      activeOpacity: 0.7,\n      disabled: !isCameraReady,\n      onLongPress: recordVideo,\n      onPressOut: stopVideoRecording,\n      onPress: takePicture,\n      style: styles.capture,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 7\n      }\n    }));\n  };\n\n  if (hasPermission === null) {\n    return React.createElement(View, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 12\n      }\n    });\n  }\n\n  if (hasPermission === false) {\n    return React.createElement(Text, {\n      style: styles.text,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 12\n      }\n    }, \"No access to camera\");\n  }\n\n  return React.createElement(SafeAreaView, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 5\n    }\n  }, React.createElement(Camera, {\n    ref: cameraRef,\n    style: styles.container,\n    type: cameraType,\n    flashMode: Camera.Constants.FlashMode.on,\n    onCameraReady: onCameraReady,\n    onMountError: function onMountError(error) {\n      console.log(\"cammera error\", error);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }), React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }\n  }, isVideoRecording && renderVideoRecordIndicator(), videoSource && renderVideoPlayer(), isPreview && renderCancelPreviewButton(), !videoSource && !isPreview && renderCaptureControl()));\n}\nvar styles = StyleSheet.create({\n  container: _objectSpread({}, StyleSheet.absoluteFillObject),\n  closeButton: {\n    position: \"absolute\",\n    top: 35,\n    left: 15,\n    height: closeButtonSize,\n    width: closeButtonSize,\n    borderRadius: Math.floor(closeButtonSize / 2),\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: \"#c4c5c4\",\n    opacity: 0.7,\n    zIndex: 2\n  },\n  media: _objectSpread({}, StyleSheet.absoluteFillObject),\n  closeCross: {\n    width: \"68%\",\n    height: 1,\n    backgroundColor: \"black\"\n  },\n  control: {\n    position: \"absolute\",\n    flexDirection: \"row\",\n    bottom: 38,\n    width: \"100%\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  capture: {\n    backgroundColor: \"#f5f6f5\",\n    borderRadius: 5,\n    height: captureSize,\n    width: captureSize,\n    borderRadius: Math.floor(captureSize / 2),\n    marginHorizontal: 31\n  },\n  recordIndicatorContainer: {\n    flexDirection: \"row\",\n    position: \"absolute\",\n    top: 25,\n    alignSelf: \"center\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: \"transparent\",\n    opacity: 0.7\n  },\n  recordTitle: {\n    fontSize: 14,\n    color: \"#ffffff\",\n    textAlign: \"center\"\n  },\n  recordDot: {\n    borderRadius: 3,\n    height: 6,\n    width: 6,\n    backgroundColor: \"#ff0000\",\n    marginHorizontal: 5\n  },\n  text: {\n    color: \"#fff\"\n  }\n});","map":{"version":3,"sources":["C:/Users/zmais/OneDrive/Desktop/react-apps/signal-chat/screens/Video/RecVideo.js"],"names":["React","useState","useRef","useEffect","Camera","Video","Audio","WINDOW_HEIGHT","Dimensions","get","height","closeButtonSize","Math","floor","captureSize","RecVideo","navigation","hasPermission","setHasPermission","Constants","Type","back","cameraType","setCameraType","isPreview","setIsPreview","isCameraReady","setIsCameraReady","isVideoRecording","setIsVideoRecording","videoSource","setVideoSource","cameraRef","requestPermissionsAsync","status","onCameraReady","takePicture","current","options","quality","base64","skipProcessing","takePictureAsync","data","source","uri","pausePreview","console","log","recordVideo","videoRecordPromise","recordAsync","warn","stopVideoRecording","stopRecording","switchCamera","prevCameraType","front","cancelPreview","resumePreview","goBackToOrig","navigate","video","renderCancelPreviewButton","styles","closeButton","closeCross","transform","rotate","renderCancelDoneButton","renderVideoPlayer","media","renderVideoRecordIndicator","recordIndicatorContainer","recordDot","recordTitle","renderCaptureControl","control","text","capture","container","FlashMode","on","error","StyleSheet","create","absoluteFillObject","position","top","left","width","borderRadius","justifyContent","alignItems","backgroundColor","opacity","zIndex","flexDirection","bottom","marginHorizontal","alignSelf","fontSize","color","textAlign"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  Dimensions,\r\n  View,\r\n  Text,\r\n  TouchableOpacity,\r\n  SafeAreaView,\r\n} from \"react-native\";\r\nimport { Camera } from \"expo-camera\";\r\nimport { Video } from \"expo-av\";\r\nimport { Audio } from \"expo-av\";\r\nimport { Button } from \"react-native\";\r\nconst WINDOW_HEIGHT = Dimensions.get(\"window\").height;\r\nconst closeButtonSize = Math.floor(WINDOW_HEIGHT * 0.032);\r\nconst captureSize = Math.floor(WINDOW_HEIGHT * 0.09);\r\n\r\n\r\nexport default function RecVideo({ navigation }) {\r\n  const [hasPermission, setHasPermission] = useState(null);\r\n  const [cameraType, setCameraType] = useState(Camera.Constants.Type.back);\r\n  const [isPreview, setIsPreview] = useState(false);\r\n  const [isCameraReady, setIsCameraReady] = useState(false);\r\n  const [isVideoRecording, setIsVideoRecording] = useState(false);\r\n  const [videoSource, setVideoSource] = useState(null);\r\n\r\n  \r\n  const cameraRef = useRef();\r\n  useEffect(() => {\r\n    (async () => {\r\n      const { status } = await Camera.requestPermissionsAsync();\r\n      await Audio.requestPermissionsAsync();\r\n      setHasPermission(status === \"granted\");\r\n    })();\r\n  }, []);\r\n  const onCameraReady = () => {\r\n    setIsCameraReady(true);\r\n  };\r\n  const takePicture = async () => {\r\n    if (cameraRef.current) {\r\n      const options = { quality: 1, base64: true, skipProcessing: true };\r\n      const data = await cameraRef.current.takePictureAsync(options);\r\n      const source = data.uri;\r\n      if (source) {\r\n        await cameraRef.current.pausePreview();\r\n        setIsPreview(true);\r\n        console.log(\"picture source\", source);\r\n      }\r\n    }\r\n  };\r\n  const recordVideo = async () => {\r\n    if (cameraRef.current) {\r\n      try {\r\n        const videoRecordPromise = cameraRef.current.recordAsync();\r\n        if (videoRecordPromise) {\r\n          setIsVideoRecording(true);\r\n          const data = await videoRecordPromise;\r\n          const source = data.uri;\r\n          if (source) {\r\n            setIsPreview(true);\r\n            console.log(\"video source\", source);\r\n            setVideoSource(source);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn(error);\r\n      }\r\n    }\r\n  };\r\n  const stopVideoRecording = () => {\r\n    if (cameraRef.current) {\r\n      setIsPreview(false);\r\n      setIsVideoRecording(false);\r\n      cameraRef.current.stopRecording();\r\n    }\r\n  };\r\n  const switchCamera = () => {\r\n    if (isPreview) {\r\n      return;\r\n    }\r\n    setCameraType((prevCameraType) =>\r\n      prevCameraType === Camera.Constants.Type.back\r\n        ? Camera.Constants.Type.front\r\n        : Camera.Constants.Type.back\r\n    );\r\n  };\r\n  const cancelPreview = async () => {\r\n    await cameraRef.current.resumePreview();\r\n    setIsPreview(false);\r\n    setVideoSource(null);\r\n  };\r\n\r\n  const goBackToOrig = async () => {\r\n      await navigation.navigate(\"Save-Video\", {video: videoSource})\r\n  }\r\n  const renderCancelPreviewButton = () => (\r\n    <>\r\n    <TouchableOpacity onPress={cancelPreview} style={styles.closeButton}>\r\n      <View style={[styles.closeCross, { transform: [{ rotate: \"45deg\" }] }]} />\r\n      <View\r\n        style={[styles.closeCross, { transform: [{ rotate: \"-45deg\" }] }]}\r\n      />\r\n    </TouchableOpacity>\r\n\r\n    {renderCancelDoneButton()}\r\n    </>\r\n  );\r\n\r\n  const renderCancelDoneButton = () => (\r\n    <Button title=\"Done\" onPress={goBackToOrig}>\r\n\r\n    </Button>\r\n  );\r\n  const renderVideoPlayer = () => (\r\n    <Video\r\n      source={{ uri: videoSource }}\r\n      shouldPlay={true}\r\n      style={styles.media}\r\n    />\r\n  );\r\n  const renderVideoRecordIndicator = () => (\r\n    <View style={styles.recordIndicatorContainer}>\r\n      <View style={styles.recordDot} />\r\n      <Text style={styles.recordTitle}>{\"Recording...\"}</Text>\r\n    </View>\r\n  );\r\n  const renderCaptureControl = () => (\r\n    <View style={styles.control}>\r\n      <TouchableOpacity disabled={!isCameraReady} onPress={switchCamera}>\r\n        <Text style={styles.text}>{\"Flip\"}</Text>\r\n      </TouchableOpacity>\r\n      <TouchableOpacity\r\n        activeOpacity={0.7}\r\n        disabled={!isCameraReady}\r\n        onLongPress={recordVideo}\r\n        onPressOut={stopVideoRecording}\r\n        onPress={takePicture}\r\n        style={styles.capture}\r\n      />\r\n    </View>\r\n  );\r\n  if (hasPermission === null) {\r\n    return <View />;\r\n  }\r\n  if (hasPermission === false) {\r\n    return <Text style={styles.text}>No access to camera</Text>;\r\n  }\r\n  return (\r\n    <SafeAreaView style={styles.container}>\r\n      <Camera\r\n        ref={cameraRef}\r\n        style={styles.container}\r\n        type={cameraType}\r\n        flashMode={Camera.Constants.FlashMode.on}\r\n        onCameraReady={onCameraReady}\r\n        onMountError={(error) => {\r\n          console.log(\"cammera error\", error);\r\n        }}\r\n      />\r\n      <View style={styles.container}>\r\n        {isVideoRecording && renderVideoRecordIndicator()}\r\n        {videoSource && renderVideoPlayer()}\r\n        {isPreview && renderCancelPreviewButton()}\r\n        {!videoSource && !isPreview && renderCaptureControl()}\r\n      </View>\r\n    </SafeAreaView>\r\n  );\r\n}\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    ...StyleSheet.absoluteFillObject,\r\n  },\r\n  closeButton: {\r\n    position: \"absolute\",\r\n    top: 35,\r\n    left: 15,\r\n    height: closeButtonSize,\r\n    width: closeButtonSize,\r\n    borderRadius: Math.floor(closeButtonSize / 2),\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    backgroundColor: \"#c4c5c4\",\r\n    opacity: 0.7,\r\n    zIndex: 2,\r\n  },\r\n  media: {\r\n    ...StyleSheet.absoluteFillObject,\r\n  },\r\n  closeCross: {\r\n    width: \"68%\",\r\n    height: 1,\r\n    backgroundColor: \"black\",\r\n  },\r\n  control: {\r\n    position: \"absolute\",\r\n    flexDirection: \"row\",\r\n    bottom: 38,\r\n    width: \"100%\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n  capture: {\r\n    backgroundColor: \"#f5f6f5\",\r\n    borderRadius: 5,\r\n    height: captureSize,\r\n    width: captureSize,\r\n    borderRadius: Math.floor(captureSize / 2),\r\n    marginHorizontal: 31,\r\n  },\r\n  recordIndicatorContainer: {\r\n    flexDirection: \"row\",\r\n    position: \"absolute\",\r\n    top: 25,\r\n    alignSelf: \"center\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    backgroundColor: \"transparent\",\r\n    opacity: 0.7,\r\n  },\r\n  recordTitle: {\r\n    fontSize: 14,\r\n    color: \"#ffffff\",\r\n    textAlign: \"center\",\r\n  },\r\n  recordDot: {\r\n    borderRadius: 3,\r\n    height: 6,\r\n    width: 6,\r\n    backgroundColor: \"#ff0000\",\r\n    marginHorizontal: 5,\r\n  },\r\n  text: {\r\n    color: \"#fff\",\r\n  },\r\n});"]},"metadata":{},"sourceType":"module"}