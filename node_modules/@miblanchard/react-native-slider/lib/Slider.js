var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.Slider=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _styles=require("./styles");var _jsxFileName="/home/runner/work/react-native-slider/react-native-slider/src/Slider.js";var Rect=function Rect(_ref){var height=_ref.height,width=_ref.width,x=_ref.x,y=_ref.y;return{containsPoint:function containsPoint(nativeX,nativeY){return nativeX>=x&&nativeY>=y&&nativeX<=x+width&&nativeY<=y+height;},height:height,trackDistanceToPoint:function trackDistanceToPoint(nativeX){if(nativeX<x){return x-nativeX;}if(nativeX>x+width){return nativeX-(x+width);}return 0;},width:width,x:x,y:y};};var DEFAULT_ANIMATION_CONFIGS={spring:{friction:7,tension:100},timing:{duration:150,easing:_reactNative.Easing.inOut(_reactNative.Easing.ease),delay:0}};function normalizeValue(props,value){if(!value||Array.isArray(value)&&value.length===0){return[0];}var maximumValue=props.maximumValue,minimumValue=props.minimumValue;var getBetweenValue=function getBetweenValue(inputValue){return Math.max(Math.min(inputValue,maximumValue),minimumValue);};if(!Array.isArray(value)){return[getBetweenValue(value)];}return value.map(getBetweenValue).sort(function(a,b){return a-b;});}function updateValues(values){var newValues=arguments.length>1&&arguments[1]!==undefined?arguments[1]:values;if(Array.isArray(newValues)&&Array.isArray(values)&&newValues.length!==values.length){return updateValues(newValues);}return values.map(function(value,i){if(value instanceof _reactNative.Animated.Value){return value.setValue(newValues[i]instanceof _reactNative.Animated.Value?newValues[i].__getValue():newValues[i]);}if(newValues[i]instanceof _reactNative.Animated.Value){return newValues[i];}return new _reactNative.Animated.Value(newValues[i]);});}function indexOfLowest(values){var lowestIndex=0;values.forEach(function(value,index,array){if(value<array[lowestIndex]){lowestIndex=index;}});return lowestIndex;}var Slider=function(_PureComponent){(0,_inherits2.default)(Slider,_PureComponent);function Slider(props){var _this;(0,_classCallCheck2.default)(this,Slider);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Slider).call(this,props));_this._handleStartShouldSetPanResponder=function(e){return _this._thumbHitTest(e);};_this._handlePanResponderGrant=function(e){var thumbSize=_this.state.thumbSize;var nativeEvent=e.nativeEvent;_this._previousLeft=_this.props.trackClickable?nativeEvent.locationX-thumbSize.width:_this._getThumbLeft(_this._getCurrentValue(_this._activeThumbIndex));_this._fireChangeEvent('onSlidingStart');};_this._handlePanResponderMove=function(e,gestureState){if(_this.props.disabled){return;}_this._setCurrentValue(_this._getValue(gestureState),_this._activeThumbIndex,function(){_this._fireChangeEvent('onValueChange');});};_this._handlePanResponderRequestEnd=function(){return false;};_this._handlePanResponderEnd=function(e,gestureState){if(_this.props.disabled){return;}_this._setCurrentValue(_this._getValue(gestureState),_this._activeThumbIndex,function(){if(_this.props.trackClickable){_this._fireChangeEvent('onValueChange');}_this._fireChangeEvent('onSlidingComplete');});_this._activeThumbIndex=0;};_this._measureContainer=function(e){_this._handleMeasure('_containerSize',e);};_this._measureTrack=function(e){_this._handleMeasure('_trackSize',e);};_this._measureThumb=function(e){_this._handleMeasure('_thumbSize',e);};_this._handleMeasure=function(name,e){var _e$nativeEvent$layout=e.nativeEvent.layout,width=_e$nativeEvent$layout.width,height=_e$nativeEvent$layout.height;var size={width:width,height:height};var currentSize=_this[name];if(currentSize&&width===currentSize.width&&height===currentSize.height){return;}_this[name]=size;if(_this._containerSize&&_this._thumbSize){_this.setState({containerSize:_this._containerSize,thumbSize:_this._thumbSize,allMeasured:true});}};_this._getRatio=function(value){var _this$props=_this.props,maximumValue=_this$props.maximumValue,minimumValue=_this$props.minimumValue;return(value-minimumValue)/(maximumValue-minimumValue);};_this._getThumbLeft=function(value){var _this$state=_this.state,containerSize=_this$state.containerSize,thumbSize=_this$state.thumbSize;var standardRatio=_this._getRatio(value);var ratio=_reactNative.I18nManager.isRTL?1-standardRatio:standardRatio;return ratio*(containerSize.width-thumbSize.width);};_this._getValue=function(gestureState){var _this$state2=_this.state,containerSize=_this$state2.containerSize,thumbSize=_this$state2.thumbSize,values=_this$state2.values;var _this$props2=_this.props,maximumValue=_this$props2.maximumValue,minimumValue=_this$props2.minimumValue,step=_this$props2.step;var length=containerSize.width-thumbSize.width;var thumbLeft=_this._previousLeft+gestureState.dx;var nonRtlRatio=thumbLeft/length;var ratio=_reactNative.I18nManager.isRTL?1-nonRtlRatio:nonRtlRatio;var minValue=minimumValue;var maxValue=maximumValue;var rawValues=_this._getRawValues(values);var buffer=step?step:0.1;if(values.length===2){if(_this._activeThumbIndex===1){minValue=rawValues[0]+buffer;}else{maxValue=rawValues[1]-buffer;}}if(step){return Math.max(minValue,Math.min(maxValue,minimumValue+Math.floor(ratio*(maximumValue-minimumValue)/step)*step));}return Math.max(minValue,Math.min(maxValue,ratio*(maximumValue-minimumValue)+minimumValue));};_this._getCurrentValue=function(){var thumbIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return _this.state.values[thumbIndex].__getValue();};_this._setCurrentValue=function(value,thumbIndex,callback){var _thumbIndex;var safeIndex=(_thumbIndex=thumbIndex)!=null?_thumbIndex:0;var animatedValue=_this.state.values[safeIndex];if(animatedValue){animatedValue.setValue(value);if(callback){callback();}}else{_this.setState(function(prevState){var newValues=(0,_toConsumableArray2.default)(prevState.values);newValues[safeIndex]=_reactNative.Animated.Value(value);return{values:newValues};},callback);}};_this._setCurrentValueAnimated=function(value){var thumbIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var animationType=_this.props.animationType;var animationConfig=(0,_extends2.default)({},DEFAULT_ANIMATION_CONFIGS[animationType],_this.props.animationConfig,{toValue:value,useNativeDriver:false});_reactNative.Animated[animationType](_this.state.values[thumbIndex],animationConfig).start();};_this._fireChangeEvent=function(changeEventType){if(_this.props[changeEventType]){_this.props[changeEventType](_this._getRawValues(_this.state.values));}};_this._getTouchOverflowSize=function(){var _this$state3=_this.state,allMeasured=_this$state3.allMeasured,containerSize=_this$state3.containerSize,thumbSize=_this$state3.thumbSize;var thumbTouchSize=_this.props.thumbTouchSize;var size={};if(allMeasured){size.width=Math.max(0,thumbTouchSize.width-thumbSize.width);size.height=Math.max(0,thumbTouchSize.height-containerSize.height);}return size;};_this._getTouchOverflowStyle=function(){var _this$_getTouchOverfl=_this._getTouchOverflowSize(),width=_this$_getTouchOverfl.width,height=_this$_getTouchOverfl.height;var touchOverflowStyle={};if(width!==undefined&&height!==undefined){var verticalMargin=-height/2;touchOverflowStyle.marginTop=verticalMargin;touchOverflowStyle.marginBottom=verticalMargin;var horizontalMargin=-width/2;touchOverflowStyle.marginLeft=horizontalMargin;touchOverflowStyle.marginRight=horizontalMargin;}if(_this.props.debugTouchArea===true){touchOverflowStyle.backgroundColor='orange';touchOverflowStyle.opacity=0.5;}return touchOverflowStyle;};_this._thumbHitTest=function(e){var nativeEvent=e.nativeEvent;var trackClickable=_this.props.trackClickable;var values=_this.state.values;var hitThumb=values.find(function(_,i){var thumbTouchRect=_this._getThumbTouchRect(i);var containsPoint=thumbTouchRect.containsPoint(nativeEvent.locationX,nativeEvent.locationY);if(containsPoint){_this._activeThumbIndex=i;}return containsPoint;});if(hitThumb){return true;}if(trackClickable){if(values.length===1){_this._activeThumbIndex=0;}else{var thumbDistances=values.map(function(value,index){var thumbTouchRect=_this._getThumbTouchRect(index);return thumbTouchRect.trackDistanceToPoint(nativeEvent.locationX);});_this._activeThumbIndex=indexOfLowest(thumbDistances);}return true;}return false;};_this._getThumbTouchRect=function(){var thumbIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var _this$state4=_this.state,containerSize=_this$state4.containerSize,thumbSize=_this$state4.thumbSize;var thumbTouchSize=_this.props.thumbTouchSize;var height=thumbTouchSize.height,width=thumbTouchSize.width;var touchOverflowSize=_this._getTouchOverflowSize();return Rect({height:height,width:width,x:touchOverflowSize.width/2+_this._getThumbLeft(_this._getCurrentValue(thumbIndex))+(thumbSize.width-width)/2,y:touchOverflowSize.height/2+(containerSize.height-height)/2});};_this._activeThumbIndex=0;_this._previousLeft=0;_this._renderDebugThumbTouchRect=function(thumbLeft,index){var _ref2=_this._getThumbTouchRect()||{},height=_ref2.height,y=_ref2.y,width=_ref2.width;var positionStyle={height:height,left:thumbLeft,top:y,width:width};return _react.default.createElement(_reactNative.Animated.View,{key:"debug-thumb-"+index,pointerEvents:"none",style:[_styles.defaultStyles.debugThumbTouchArea,positionStyle],__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:520}});};_this._renderThumbImage=function(){var thumbIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var thumbImage=_this.props.thumbImage;if(!thumbImage){return null;}return _react.default.createElement(_reactNative.Image,{source:Array.isArray(thumbImage)?thumbImage[thumbIndex]:thumbImage,__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:536}});};_this._panResponder=_reactNative.PanResponder.create({onStartShouldSetPanResponder:_this._handleStartShouldSetPanResponder,onMoveShouldSetPanResponder:_this._handleMoveShouldSetPanResponder,onPanResponderGrant:_this._handlePanResponderGrant,onPanResponderMove:_this._handlePanResponderMove,onPanResponderRelease:_this._handlePanResponderEnd,onPanResponderTerminationRequest:_this._handlePanResponderRequestEnd,onPanResponderTerminate:_this._handlePanResponderEnd});_this.state={allMeasured:false,containerSize:{width:0,height:0},thumbSize:{width:0,height:0},trackMarksValues:updateValues(normalizeValue(_this.props,_this.props.trackMarks)),values:updateValues(normalizeValue(_this.props,_this.props.value))};return _this;}(0,_createClass2.default)(Slider,[{key:"componentDidUpdate",value:function componentDidUpdate(){var _this2=this;var newValues=normalizeValue(this.props,this.props.value);newValues.forEach(function(value,i){if(!_this2.state.values[i]){_this2._setCurrentValue(value,i);}else if(value!==_this2.state.values[i].__getValue()){if(_this2.props.animateTransitions){_this2._setCurrentValueAnimated(value,i);}else{_this2._setCurrentValue(value,i);}}});}},{key:"_getRawValues",value:function _getRawValues(values){return values.map(function(value){return value.__getValue();});}},{key:"_handleMoveShouldSetPanResponder",value:function _handleMoveShouldSetPanResponder(){return false;}},{key:"render",value:function render(){var _this3=this;var _this$props3=this.props,animateTransitions=_this$props3.animateTransitions,animationType=_this$props3.animationType,containerStyle=_this$props3.containerStyle,debugTouchArea=_this$props3.debugTouchArea,maximumTrackTintColor=_this$props3.maximumTrackTintColor,maximumValue=_this$props3.maximumValue,minimumTrackTintColor=_this$props3.minimumTrackTintColor,minimumValue=_this$props3.minimumValue,renderAboveThumbComponent=_this$props3.renderAboveThumbComponent,renderTrackMarkComponent=_this$props3.renderTrackMarkComponent,renderThumbComponent=_this$props3.renderThumbComponent,thumbImage=_this$props3.thumbImage,thumbStyle=_this$props3.thumbStyle,thumbTintColor=_this$props3.thumbTintColor,thumbTouchSize=_this$props3.thumbTouchSize,trackStyle=_this$props3.trackStyle,other=(0,_objectWithoutProperties2.default)(_this$props3,["animateTransitions","animationType","containerStyle","debugTouchArea","maximumTrackTintColor","maximumValue","minimumTrackTintColor","minimumValue","renderAboveThumbComponent","renderTrackMarkComponent","renderThumbComponent","thumbImage","thumbStyle","thumbTintColor","thumbTouchSize","trackStyle"]);var _this$state5=this.state,allMeasured=_this$state5.allMeasured,containerSize=_this$state5.containerSize,thumbSize=_this$state5.thumbSize,trackMarksValues=_this$state5.trackMarksValues,values=_this$state5.values;var interpolatedThumbValues=values.map(function(v){return v.interpolate({inputRange:[minimumValue,maximumValue],outputRange:_reactNative.I18nManager.isRTL?[0,-(containerSize.width-thumbSize.width)]:[0,containerSize.width-thumbSize.width]});});var interpolatedTrackValues=values.map(function(v){return v.interpolate({inputRange:[minimumValue,maximumValue],outputRange:[0,containerSize.width-thumbSize.width]});});var interpolatedTrackMarksValues=trackMarksValues&&trackMarksValues.map(function(v){return v.interpolate({inputRange:[minimumValue,maximumValue],outputRange:_reactNative.I18nManager.isRTL?[0,-(containerSize.width-thumbSize.width)]:[0,containerSize.width-thumbSize.width]});});var valueVisibleStyle={};if(!allMeasured){valueVisibleStyle.opacity=0;}var interpolatedRawValues=this._getRawValues(interpolatedTrackValues);var minThumbValue=new _reactNative.Animated.Value(Math.min.apply(Math,(0,_toConsumableArray2.default)(interpolatedRawValues)));var maxThumbValue=new _reactNative.Animated.Value(Math.max.apply(Math,(0,_toConsumableArray2.default)(interpolatedRawValues)));var minimumTrackStyle=(0,_extends2.default)({position:'absolute',left:interpolatedTrackValues.length===1?new _reactNative.Animated.Value(0):_reactNative.Animated.add(minThumbValue,thumbSize.width/2),width:interpolatedTrackValues.length===1?_reactNative.Animated.add(interpolatedTrackValues[0],thumbSize.width/2):_reactNative.Animated.add(_reactNative.Animated.multiply(minThumbValue,-1),maxThumbValue),backgroundColor:minimumTrackTintColor},valueVisibleStyle);var touchOverflowStyle=this._getTouchOverflowStyle();return _react.default.createElement(_react.default.Fragment,null,renderAboveThumbComponent&&_react.default.createElement(_reactNative.View,{style:_styles.defaultStyles.aboveThumbComponentsContainer,__self:this,__source:{fileName:_jsxFileName,lineNumber:638}},interpolatedThumbValues.map(function(value,i){return _react.default.createElement(_reactNative.Animated.View,{key:"slider-above-thumb-"+i,style:[_styles.defaultStyles.renderThumbComponent,(0,_extends2.default)({bottom:0,transform:[{translateX:value},{translateY:0}]},valueVisibleStyle)],__self:_this3,__source:{fileName:_jsxFileName,lineNumber:640}},renderAboveThumbComponent(i));})),_react.default.createElement(_reactNative.View,(0,_extends2.default)({},other,{style:[_styles.defaultStyles.container,containerStyle],onLayout:this._measureContainer,__self:this,__source:{fileName:_jsxFileName,lineNumber:659}}),_react.default.createElement(_reactNative.View,{renderToHardwareTextureAndroid:true,style:[_styles.defaultStyles.track,{backgroundColor:maximumTrackTintColor},trackStyle],onLayout:this._measureTrack,__self:this,__source:{fileName:_jsxFileName,lineNumber:663}}),_react.default.createElement(_reactNative.Animated.View,{renderToHardwareTextureAndroid:true,style:[_styles.defaultStyles.track,trackStyle,minimumTrackStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:672}}),renderTrackMarkComponent&&interpolatedTrackMarksValues&&interpolatedTrackMarksValues.map(function(value,i){return _react.default.createElement(_reactNative.Animated.View,{key:"track-mark-"+i,style:[_styles.defaultStyles.renderThumbComponent,(0,_extends2.default)({transform:[{translateX:value},{translateY:0}]},valueVisibleStyle)],__self:_this3,__source:{fileName:_jsxFileName,lineNumber:679}},renderTrackMarkComponent(i));}),interpolatedThumbValues.map(function(value,i){return _react.default.createElement(_reactNative.Animated.View,{key:"slider-thumb-"+i,style:[renderThumbComponent?_styles.defaultStyles.renderThumbComponent:_styles.defaultStyles.thumb,renderThumbComponent?{}:(0,_extends2.default)({backgroundColor:thumbTintColor},thumbStyle),(0,_extends2.default)({transform:[{translateX:value},{translateY:0}]},valueVisibleStyle)],onLayout:_this3._measureThumb,__self:_this3,__source:{fileName:_jsxFileName,lineNumber:695}},renderThumbComponent?renderThumbComponent():_this3._renderThumbImage(i));}),_react.default.createElement(_reactNative.View,(0,_extends2.default)({style:[_styles.defaultStyles.touchArea,touchOverflowStyle]},this._panResponder.panHandlers,{__self:this,__source:{fileName:_jsxFileName,lineNumber:721}}),!!debugTouchArea&&interpolatedThumbValues.map(function(value,i){return _this3._renderDebugThumbTouchRect(value,i);}))));}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){if(props.trackMarks&&!!state.trackMarksValues&&state.trackMarksValues.length>0){var newTrackMarkValues=normalizeValue(props,props.trackMarks);var statePatch={};if(state.trackMarksValues&&newTrackMarkValues.length!==state.trackMarksValues.length){statePatch.trackMarksValues=updateValues(state.trackMarksValues,newTrackMarkValues);}return statePatch;}}}]);return Slider;}(_react.PureComponent);exports.Slider=Slider;Slider.defaultProps={animationType:'timing',debugTouchArea:false,trackMarks:[],maximumTrackTintColor:'#b3b3b3',maximumValue:1,minimumTrackTintColor:'#3f3f3f',minimumValue:0,step:0,thumbTintColor:'#343434',thumbTouchSize:{width:40,height:40},trackClickable:true,value:0};